<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Portal - Register</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .register-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #11a85d 0%, #4f46e5 100%);
      }
      .form-card {
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        border-radius: 1rem;
        transition: all 0.3s ease;
      }
      .form-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }
      .btn-primary {
        background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        background: linear-gradient(90deg, #4338ca 0%, #4f46e5 100%);
        transform: translateY(-2px);
      }
      .input-field {
        transition: all 0.3s ease;
        border: 2px solid #e5e7eb;
      }
      .input-field:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }
      .link {
        color: #4f46e5;
        transition: all 0.3s ease;
      }
      .link:hover {
        color: #4338ca;
        text-decoration: underline;
      }
      .role-selector {
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
      }
      .role-selector:hover {
        border-color: #6366f1;
        background-color: #f0f4ff;
      }
      .role-selector.selected {
        border-color: #4f46e5;
        background-color: #eef2ff;
      }
    </style>
  </head>
  <body>
    <div
      class="register-container flex items-center justify-center w-full py-8"
    >
      <div class="form-card w-full max-w-2xl p-8 mx-4 my-10">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold text-gray-900">Create an Account</h1>
          <p class="text-gray-600 mt-2">
            Join our job portal to find your dream job or hire top talent
          </p>
        </div>

        <div
          id="error-message"
          class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
        ></div>
        <div
          id="success-message"
          class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"
        ></div>

        <form id="register-form" class="space-y-6">
          <div class="mb-8">
            <p class="text-gray-700 mb-3 font-medium">I want to:</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div
                id="role-job-seeker"
                class="role-selector p-4 rounded-lg cursor-pointer flex items-center"
              >
                <input
                  type="radio"
                  id="job-seeker"
                  name="role"
                  value="JOB_SEEKER"
                  class="h-4 w-4 text-indigo-600"
                  checked
                />
                <label for="job-seeker" class="ml-3 block cursor-pointer">
                  <span class="font-medium text-gray-800">Find a Job</span>
                  <p class="text-sm text-gray-500">
                    Create a profile and upload your resume
                  </p>
                </label>
              </div>
              <div
                id="role-employer"
                class="role-selector p-4 rounded-lg cursor-pointer flex items-center"
              >
                <input
                  type="radio"
                  id="employer"
                  name="role"
                  value="EMPLOYER"
                  class="h-4 w-4 text-indigo-600"
                />
                <label for="employer" class="ml-3 block cursor-pointer">
                  <span class="font-medium text-gray-800">Hire Talent</span>
                  <p class="text-sm text-gray-500">
                    Post jobs and find candidates
                  </p>
                </label>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label
                for="first_name"
                class="block text-sm font-medium text-gray-700 mb-1"
                >First Name</label
              >
              <input
                type="text"
                id="first_name"
                name="first_name"
                required
                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
              />
            </div>

            <div>
              <label
                for="last_name"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Last Name</label
              >
              <input
                type="text"
                id="last_name"
                name="last_name"
                required
                class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
              />
            </div>
          </div>

          <div>
            <label
              for="username"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Username</label
            >
            <input
              type="text"
              id="username"
              name="username"
              required
              class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
            />
          </div>

          <div>
            <label
              for="password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Password</label
            >
            <input
              type="password"
              id="password"
              name="password"
              required
              class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
            />
            <p class="text-xs text-gray-500 mt-1">
              Password must be at least 8 characters long
            </p>
          </div>

          <div>
            <label
              for="confirm_password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Confirm Password</label
            >
            <input
              type="password"
              id="confirm_password"
              name="confirm_password"
              required
              class="input-field w-full px-4 py-3 rounded-lg focus:outline-none"
            />
          </div>

          <div class="flex items-center">
            <input
              id="terms"
              name="terms"
              type="checkbox"
              required
              class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
            />
            <label for="terms" class="ml-2 block text-sm text-gray-700">
              I agree to the <a href="#" class="link">Terms of Service</a> and
              <a href="#" class="link">Privacy Policy</a>
            </label>
          </div>

          <div>
            <button
              type="submit"
              class="btn-primary w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white focus:outline-none"
            >
              Create Account
            </button>
          </div>
        </form>

        <div class="text-center mt-6">
          <p class="text-sm text-gray-600">
            Already have an account?
            <a href="/api/login" class="link font-medium">Sign in</a>
          </p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Role selector functionality
        const roleJobSeeker = document.getElementById("role-job-seeker");
        const roleEmployer = document.getElementById("role-employer");
        const jobSeekerRadio = document.getElementById("job-seeker");
        const employerRadio = document.getElementById("employer");

        roleJobSeeker.classList.add("selected");

        roleJobSeeker.addEventListener("click", function () {
          jobSeekerRadio.checked = true;
          roleJobSeeker.classList.add("selected");
          roleEmployer.classList.remove("selected");
        });

        roleEmployer.addEventListener("click", function () {
          employerRadio.checked = true;
          roleEmployer.classList.add("selected");
          roleJobSeeker.classList.remove("selected");
        });

        // Form submission
        const registerForm = document.getElementById("register-form");
        const errorMessage = document.getElementById("error-message");
        const successMessage = document.getElementById("success-message");

        registerForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          // Hide any previous messages
          errorMessage.classList.add("hidden");
          successMessage.classList.add("hidden");

          // Form validation
          const password = document.getElementById("password").value;
          const confirmPassword =
            document.getElementById("confirm_password").value;

          if (password !== confirmPassword) {
            errorMessage.textContent = "Passwords do not match";
            errorMessage.classList.remove("hidden");
            return;
          }

          if (password.length < 8) {
            errorMessage.textContent =
              "Password must be at least 8 characters long";
            errorMessage.classList.remove("hidden");
            return;
          }

          // Get form data
          const formData = {
            first_name: document.getElementById("first_name").value,
            last_name: document.getElementById("last_name").value,
            username: document.getElementById("username").value,
            password: password,
            role: document.querySelector('input[name="role"]:checked').value,
          };

          try {
            const response = await fetch(
              "http://localhost:8000/api/register/",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              }
            );

            if (response.status === 201) {
              // Show success message
              successMessage.textContent =
                "Registration successful! Redirecting to login...";
              successMessage.classList.remove("hidden");

              // Redirect to login page after a short delay
              setTimeout(() => {
                window.location.href = "/api/login";
              }, 2000);
            } else {
              // Get the error details from the response
              const errorData = await response.json();
              let errorText = "Registration failed";

              // Format the error messages
              if (errorData) {
                const errorMessages = [];
                for (const key in errorData) {
                  if (Array.isArray(errorData[key])) {
                    errorMessages.push(`${key}: ${errorData[key].join(", ")}`);
                  } else {
                    errorMessages.push(`${key}: ${errorData[key]}`);
                  }
                }
                errorText = errorMessages.join(". ");
              }

              errorMessage.textContent = errorText;
              errorMessage.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Error:", error);
            errorMessage.textContent = "Network error. Please try again.";
            errorMessage.classList.remove("hidden");
          }
        });
      });
    </script>
  </body>
</html>
